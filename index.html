<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì£¼ì‹ ì˜ í”ì </title>
  <link rel="icon" href="https://lh3.googleusercontent.com/d/1r51_in8C0TKK-OqfrFtSfWw7kyHIO0z1" type="image/png">
  <style>
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      background: #333;
      color: #fff;
    }
.page-title {
  position: fixed;
  top: 6px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 24px;
  font-weight: bold;
  color: #fff;
  z-index: 1000;
  background: #333;
  padding: 10px 20px
  text-align: center;
}

.top-buttons {
  margin-top: 8px;
  display: flex;
  justify-content: center;
  gap: 10px;
}

.top-buttons button {
  padding: 6px 12px;
  font-size: 14px;
  background: #666;
  color: #fff;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
.top-buttons button:hover {
  background: #888;
}

    /* ì¢Œì¸¡ ë©”ë‰´ */
    .sidebar {
      width: 200px;
 margin-top: 95px;
      background: #222;
      padding: 10px;
      box-sizing: border-box;
    }
    .sidebar button {
      display: block;
      width: 100%;
      margin-bottom: 8px;
      padding: 8px;
      background: #666;
      border: none;
      color: #fff;
      cursor: pointer;
  font-size: 18px;
    }
    .sidebar button:hover { background: #666; }

.link-button {
  display: inline-block;
  padding: 8px 12px;
  background-color: #666;   /* íšŒìƒ‰ ë°°ê²½ */
  color: #fff;              /* í° ê¸€ì”¨ */
  border-radius: 4px;
  text-decoration: none;    /* ë°‘ì¤„ ì œê±° */
  cursor: pointer;
  margin-left: 22px;        /* ì™¼ìª½ ì—¬ë°± ì¶”ê°€ */
}

.link-button:hover {
  background-color: #888;   /* ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ ì¡°ê¸ˆ ë” ë°ì€ íšŒìƒ‰ */
}

    /* ì§€ë„ ë°•ìŠ¤ */
.map-container {
  width: calc(100vw - 200px); /* ì „ì²´ ë„ˆë¹„ - ì‚¬ì´ë“œë°” */
  height: calc(100vh - 70px); /* ì „ì²´ ë†’ì´ - íƒ€ì´í‹€ */
  margin-top: 95px;
  overflow: hidden;
  position: relative;
  background: #777;
  touch-action: none;
  cursor: grab;
  border-left: 2px solid #666;
}


    .map-wrap {
      position: absolute;
      top: 0; left: 0;
      transform-origin: 0 0;
    }
.map-wrap img {
  display: block;
  max-width: none;   /* ì›ë³¸ í¬ê¸° ê·¸ëŒ€ë¡œ ì‚¬ìš© */
  height: auto;
  user-select: none;
  pointer-events: none;
}

.marker-count {
  margin-top: 20px;
  padding: 8px;
  background: #222;
  color: #fff;
  text-align: center;
  font-size: 20px;
  border-top: 1px solid #444;
}

    .marker {
      position: absolute;
      transform: translate(-50%, -50%);
      width: 25px;
      height: 25px;
      background: url('https://cdn-icons-png.flaticon.com/512/190/190411.png') no-repeat center/contain;
      cursor: pointer;
    }
    /* ë²„íŠ¼ì„ ë°•ìŠ¤ ìœ„ ì¤‘ì•™ì— */
    .controls {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      display: flex;
      gap: 8px;
    }
    .controls button {
      padding: 6px 10px;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <!-- ìƒë‹¨ íƒ€ì´í‹€ -->
<!-- ìƒë‹¨ íƒ€ì´í‹€ -->
<div class="page-title">
  ğŸª¶ì˜¤ì˜¤ ì£¼ì‹ ì˜ í”ì ì´ì‹œì—¬..!ğŸª¶

  <!-- íƒ€ì´í‹€ ì•„ë˜ ë²„íŠ¼ -->
  <div class="top-buttons">
    <button id="resetMarkers">ë§ˆì»¤ ì´ˆê¸°í™”</button>
  </div>
</div>


  <!-- ì¢Œì¸¡ ë©”ë‰´ -->
  <div class="sidebar">
    <button data-map="map1">ğŸ˜ˆë§ˆì¡±ğŸ˜ˆ</button>
    <button data-map="map2">âš”ï¸ì–´ë¹„ìŠ¤(200ê°œ)âš”ï¸</button>
  <a href="https://tc-imba.com/aion2-interactive-map/?map=World_D_A" target="_blank" class="link-button">
    ì •í™•í•œ ìœ„ì¹˜ ë³´ê¸°
  </a>
  <div id="markerCount" class="marker-count">ìˆ˜ì§‘ í˜„í™©<br>0 / 560</div>
  </div>

  <!-- ì§€ë„ ì˜ì—­ -->
  <div class="map-container" id="mapContainer">
    <div class="map-wrap" id="mapWrap">
      <img src="https://8upload.com/image/affccf32a5cf33e4/map.jpg" alt="ì§€ë„" id="map">
    </div>
  </div>



  <script>
    const container = document.getElementById("mapContainer");
    const mapWrap = document.getElementById("mapWrap");
    const map = document.getElementById("map");
    const btnResetMarkers = document.getElementById("resetMarkers");
    const btnResetView = document.getElementById("resetView");
    const buttons = document.querySelectorAll(".sidebar button");

    // ì§€ë„ ëª©ë¡
    const maps = {
      map1: "https://8upload.com/image/affccf32a5cf33e4/map.jpg",
      map2: "https://8upload.com/image/c11d7cc089072436/abyss.jpg"
    };
    let currentMap = "map1";

    // ë·° ìƒíƒœ
    let scale = 1;
    let translateX = 0;
    let translateY = 0;
    let isDragging = false;
    let dragStartX, dragStartY, lastX, lastY;
    let inputFromMarker = false;

    // ë§ˆì»¤ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° (ì§€ë„ë³„ ë¶„ë¦¬)
    function loadMarkers(mapId) {
      return JSON.parse(localStorage.getItem("map-markers-" + mapId)) || [];
    }
    function saveMarkers(mapId, markers) {
      localStorage.setItem("map-markers-" + mapId, JSON.stringify(markers));
    }

function updateMarkerCount() {
  const count = document.querySelectorAll(".marker").length;
  document.getElementById("markerCount").innerHTML = `ìˆ˜ì§‘ í˜„í™©<br>${count} / 560`;
}

    // ë§ˆì»¤ ìƒì„±
    function createMarker(x, y) {
      const marker = document.createElement("div");
      marker.className = "marker";
      marker.style.left = x + "px";
      marker.style.top = y + "px";
      marker.dataset.x = String(x);
      marker.dataset.y = String(y);

      marker.addEventListener("mousedown", (e) => { e.stopPropagation(); inputFromMarker = true; });
      marker.addEventListener("touchstart", (e) => { e.stopPropagation(); inputFromMarker = true; }, { passive: false });

      marker.addEventListener("click", (e) => {
        e.stopPropagation();
        removeMarkerElement(marker);
      });
      marker.addEventListener("touchend", (e) => {
        e.stopPropagation();
        removeMarkerElement(marker);
      }, { passive: false });

      mapWrap.appendChild(marker);
updateMarkerCount();
    }

    function removeMarkerElement(marker) {
      const x = marker.dataset.x;
      const y = marker.dataset.y;
      marker.remove();
      let markers = loadMarkers(currentMap);
      markers = markers.filter(m => !(String(m.x) === x && String(m.y) === y));
      saveMarkers(currentMap, markers);
updateMarkerCount();
    }

    // ì§€ë„ ì „í™˜
buttons.forEach(btn => {
  btn.addEventListener("click", () => {
    // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
    document.querySelectorAll(".marker").forEach(m => m.remove());

    // ì§€ë„ êµì²´
    currentMap = btn.dataset.map;
    map.src = maps[currentMap];

    // ì´ë¯¸ì§€ê°€ ë¡œë“œëœ í›„ ê²½ê³„ ê³„ì‚°
    map.onload = () => {
      scale = 1;
      translateX = 0;
      translateY = 0;
      updateTransform();
      // í•´ë‹¹ ì§€ë„ ë§ˆì»¤ ë³µì›
      loadMarkers(currentMap).forEach(m => createMarker(m.x, m.y));
updateMarkerCount();
    };
  });
});


    // ì´ˆê¸° ë¡œë“œ ì‹œ ë§ˆì»¤ ë³µì›
    loadMarkers(currentMap).forEach(m => createMarker(m.x, m.y));
updateMarkerCount();

    // PC: ë§ˆìš°ìŠ¤ íœ  ì¤Œ (1~5ë°°, ë§ˆìš°ìŠ¤ ìœ„ì¹˜ ê¸°ì¤€)
    container.addEventListener("wheel", (e) => {
      e.preventDefault();
      const rect = container.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;

      const prevScale = scale;
      scale = e.deltaY < 0 ? scale * 1.1 : scale / 1.1;
      scale = Math.min(Math.max(scale, 0.2), 5);

      translateX = mouseX - (mouseX - translateX) * (scale / prevScale);
      translateY = mouseY - (mouseY - translateY) * (scale / prevScale);

      updateTransform();
    }, { passive: false });

    // PC: ë“œë˜ê·¸ ì´ë™ + í´ë¦­ êµ¬ë¶„
    container.addEventListener("mousedown", (e) => {
      isDragging = false;
      dragStartX = e.clientX;
      dragStartY = e.clientY;
      lastX = e.clientX;
      lastY = e.clientY;
      inputFromMarker = false;
    });
    container.addEventListener("mousemove", (e) => {
      if (dragStartX == null) return;
      const dx = e.clientX - lastX;
      const dy = e.clientY - lastY;
      if (Math.abs(e.clientX - dragStartX) > 5 || Math.abs(e.clientY - dragStartY) > 5) {
        isDragging = true;
      }
      if (isDragging) {
        translateX += dx;
        translateY += dy;
        updateTransform();
      }
      lastX = e.clientX;
      lastY = e.clientY;
    });
    container.addEventListener("mouseup", (e) => {
      if (inputFromMarker) { cleanupPointerState(); return; }
      if (!isDragging) {
        const rect = container.getBoundingClientRect();
        const x = ((e.clientX - rect.left - translateX) / scale).toFixed(2);
        const y = ((e.clientY - rect.top - translateY) / scale).toFixed(2);
        createMarker(x, y);
        const markers = loadMarkers(currentMap);
        markers.push({x, y});
        saveMarkers(currentMap, markers);
      }
      cleanupPointerState();
    });

    // ëª¨ë°”ì¼: í•€ì¹˜ ì¤Œ + ë“œë˜ê·¸ + íƒ­ ë§ˆì»¤
    let lastTouchDist = null;
    let lastTouchMid = null;
    let touchStartX, touchStartY, touchMoved = false;

    container.addEventListener("touchstart", (e) => {
      if (e.touches.length === 1) {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
        lastX = touchStartX;
        lastY = touchStartY;
        touchMoved = false;
        inputFromMarker = false;
      } else if (e.touches.length === 2) {
        lastTouchDist = getTouchDist(e.touches);
        lastTouchMid = getTouchMid(e.touches);
      }
    }, { passive: false });

    container.addEventListener("touchmove", (e) => {
      e.preventDefault();
      if (e.touches.length === 1) {
        const dx = e.touches[0].clientX - lastX;
        const dy = e.touches[0].clientY - lastY;
        if (Math.abs(e.touches[0].clientX - touchStartX) > 5 || Math.abs(e.touches[0].clientY - touchStartY) > 5) {
          touchMoved = true;
        }
        if (touchMoved) {
          translateX += dx;
          translateY += dy;
          updateTransform();
        }
        lastX = e.touches[0].clientX;
        lastY = e.touches[0].clientY;
      } else if (e.touches.length === 2) {
        const newDist = getTouchDist(e.touches);
        const mid = getTouchMid(e.touches);

        const prevScale = scale;
        scale *= newDist / lastTouchDist;
        scale = Math.min(Math.max(scale, 1), 5);

        translateX = mid.x - (mid.x - translateX) * (scale / prevScale);
        translateY = mid.y - (mid.y - translateY) * (scale / prevScale);

        lastTouchDist = newDist;
        lastTouchMid = mid;
        updateTransform();
      }
    }, { passive: false });

    container.addEventListener("touchend", (e) => {
      if (inputFromMarker) { inputFromMarker = false; return; }
      // í•œ ì†ê°€ë½ íƒ­ìœ¼ë¡œ ì¢…ë£Œë˜ê³ , ì´ë™ì´ ê±°ì˜ ì—†ì—ˆë‹¤ë©´ ë§ˆì»¤ ìƒì„±
      if (e.touches.length === 0 && e.changedTouches.length === 1 && !touchMoved) {
        const rect = container.getBoundingClientRect();
        const x = ((e.changedTouches[0].clientX - rect.left - translateX) / scale).toFixed(2);
        const y = ((e.changedTouches[0].clientY - rect.top - translateY) / scale).toFixed(2);
        createMarker(x, y);
        const markers = loadMarkers(currentMap);
        markers.push({x, y});
        saveMarkers(currentMap, markers);
      }
    });

    // ìœ í‹¸
    function getTouchDist(touches) {
      const dx = touches[0].clientX - touches[1].clientX;
      const dy = touches[0].clientY - touches[1].clientY;
      return Math.sqrt(dx*dx + dy*dy);
    }
    function getTouchMid(touches) {
      return { x: (touches[0].clientX + touches[1].clientX) / 2, y: (touches[0].clientY + touches[1].clientY) / 2 };
    }
    function cleanupPointerState() {
      dragStartX = dragStartY = null;
      isDragging = false;
      inputFromMarker = false;
    }

    // ê²½ê³„ í´ë¨í”„ + ë³€í™˜ ì ìš©
    function updateTransform() {
      const containerRect = container.getBoundingClientRect();
      const img = mapWrap.querySelector("img");
      const naturalW = img.naturalWidth;
      const naturalH = img.naturalHeight;

      const mapWidth = naturalW * scale;
      const mapHeight = naturalH * scale;

      const minX = containerRect.width - mapWidth;
      const minY = containerRect.height - mapHeight;
      const maxX = 0;
      const maxY = 0;

      translateX = Math.min(Math.max(translateX, minX), maxX);
      translateY = Math.min(Math.max(translateY, minY), maxY);

      mapWrap.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
    }


// ì´ˆê¸°í™”
btnResetMarkers.addEventListener("click", (e) => {
  e.preventDefault();     // ê¸°ë³¸ ë™ì‘ ì°¨ë‹¨
  e.stopPropagation();    // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ë¡œ ì „ë‹¬ë˜ì§€ ì•Šë„ë¡ ì°¨ë‹¨

  if (confirm("âš ï¸ ëª¨ë“  ë§ˆì»¤ê°€ ì‚­ì œë©ë‹ˆë‹¤.\nì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
    localStorage.removeItem("map-markers-" + currentMap);
    document.querySelectorAll(".marker").forEach(m => m.remove());
    updateMarkerCount();
  }
});

  </script>
</body>
</html>








